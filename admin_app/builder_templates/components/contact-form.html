<section class="contact-section" {% if anchor_id %}id="{{ anchor_id }}"{% endif %}>
  <div class="container">
    <div class="section-heading text-center">
      <h2>{{ title }}</h2>
      {% if subtitle %}
      <p class="subtitle">{{ subtitle }}</p>
      {% endif %}
    </div>
    <form class="contact-form" id="contact-form-{{ component_id }}" onsubmit="submitContactForm(event, '{{ component_id }}')">
      <div class="form-group">
        <label for="name-{{ component_id }}">Name</label>
        <input type="text" id="name-{{ component_id }}" name="name" required>
      </div>
      <div class="form-group">
        <label for="email-{{ component_id }}">Email</label>
        <input type="email" id="email-{{ component_id }}" name="email" required>
      </div>
      {% if show_phone %}
      <div class="form-group">
        <label for="phone-{{ component_id }}">Phone</label>
        <input type="tel" id="phone-{{ component_id }}" name="phone">
      </div>
      {% endif %}
      <div class="form-group">
        <label for="message-{{ component_id }}">Message</label>
        <textarea id="message-{{ component_id }}" name="message" required></textarea>
      </div>
      <button type="submit" class="btn">{{ submit_text }}</button>
      <div id="form-status-{{ component_id }}" style="margin-top: 1rem;"></div>
    </form>
  </div>
</section>
<script>
async function submitContactForm(event, componentId) {
  event.preventDefault();
  const form = event.target;
  const status = document.getElementById('form-status-' + componentId);
  const btn = form.querySelector('button[type="submit"]');

  btn.disabled = true;
  btn.textContent = 'Sending...';

  const data = {
    name: form.querySelector('[name="name"]').value,
    email: form.querySelector('[name="email"]').value,
    phone: form.querySelector('[name="phone"]') ? form.querySelector('[name="phone"]').value : '',
    message: form.querySelector('[name="message"]').value
  };

  try {
    const response = await fetch('https://edit.bstroh.com/contact/{{ email | replace("@", "-at-") | replace(".", "-dot-") }}', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (response.ok) {
      status.innerHTML = '<span style="color: var(--color-success);">{{ success_message }}</span>';
      form.reset();
    } else {
      status.innerHTML = '<span style="color: var(--color-error);">Something went wrong. Please try again.</span>';
    }
  } catch (error) {
    status.innerHTML = '<span style="color: var(--color-error);">Something went wrong. Please try again.</span>';
  }

  btn.disabled = false;
  btn.textContent = '{{ submit_text }}';
}
</script>
